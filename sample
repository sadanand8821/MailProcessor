import groovy.json.JsonSlurper

// Get JSON response
def response = prev.getResponseDataAsString()

// Parse JSON
def json = new JsonSlurper().parseText(response)

// Recursive function to extract keys
def extractKeys(obj, parentKey = "") {
    if (obj instanceof Map) {
        obj.each { key, value ->
            def newKey = parentKey ? "${parentKey}.${key}" : key // Maintain key hierarchy
            extractKeys(value, newKey)
        }
    } else if (obj instanceof List) {
        obj.eachWithIndex { item, index ->
            extractKeys(item, "${parentKey}[${index}]") // Handle arrays with indices
        }
    } else {
        vars.put(parentKey, obj.toString()) // Store in JMeter variables
    }
}

// Start extraction
extractKeys(json)
